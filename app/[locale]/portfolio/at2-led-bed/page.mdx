import Link from 'next/link'
import { getDictionary } from '../../../i18n/getDictionary'
import PCBViewer from '../../../components/PCBViewer'

export async function generateMetadata({ params }) {
  return {
    title: 'AT2 3D Printer LED Bed',
    description: 'Compact 4-layer board driving addressable LEDs with ESP32-C3FH4.'
  }
}

export default async function Page({ params }) {
  const locale = params?.locale || 'en'
  const t = await getDictionary(locale)

  return (
    <article className="max-w-4xl">
      <p className="mb-4">
        <Link href={`/${locale}/portfolio`} className="nav-link">
          ‚Üê {t.common.backToPortfolio}
        </Link>
      </p>
      
      <h1 className="text-4xl md:text-5xl font-bold text-neutral-900 dark:text-white mb-4">
        AT2 3D Printer LED Bed
      </h1>
      
      <p className="text-xl text-neutral-600 dark:text-neutral-300 mb-8">
        Compact 4-layer board driving addressable LEDs with ESP32-C3FH4.
      </p>

      {/*3D PCB Viewer */}
      <div className="mb-8">
        <PCBViewer stepFile="/models/at2.glb" />
      </div>

      <div className="prose prose-neutral dark:prose-invert max-w-none">
        <h2>Overview</h2>
        <p>A compact, four-layer control board that sits beneath AT2 print bed and drives addressable LEDs for decorative and functional feedback. This project demonstrates high-quality PCB design with dedicated power planes and efficient LED driving.</p>

        <h2>Design Philosophy</h2>
        <p>Signal integrity and power quality guide this design. The 4-layer stack-up with dedicated VCC and GND planes ensures clean, noise-free power delivery to addressable LEDs, preventing color artifacts and ensuring consistent performance.</p>

        <h2>Key Features</h2>
        <ul>
          <li><strong>ESP32-C3FH4:</strong> MCU with integrated PCB antenna (Wi-Fi + BLE)</li>
          <li><strong>Independent LED Outputs:</strong> Logo chain and status bar</li>
          <li><strong>Level Shifters:</strong> 3.3 V to 5 V level-shifters on each data line</li>
          <li><strong>Protection:</strong> 3 A Littelfuse on 5 V rail</li>
          <li><strong>Connectors:</strong> SMD JST-XH for plug-and-play wiring</li>
          <li><strong>4-Layer Design:</strong> Dedicated VCC and GND planes for low noise</li>
        </ul>

        <h2>Technical Implementation</h2>
        <h3>Board Stack-up</h3>
        <ul>
          <li><strong>Top:</strong> Signals and components</li>
          <li><strong>Inner 1:</strong> Solid VCC plane (LED rail)</li>
          <li><strong>Inner 2:</strong> Solid GND plane</li>
          <li><strong>Bottom:</strong> Signals and components</li>
        </ul>

        <h3>Power Architecture</h3>
        <p>Board operates from existing 5 V supply with robust protection:</p>
        <ul>
          <li><strong>Input:</strong> Existing 5 V supply (no on-board buck converter)</li>
          <li><strong>Protection:</strong> 3 A Littelfuse protects entire board</li>
          <li><strong>LED Current Budget:</strong> 2.6 A worst-case (44 WS2812B-MINI-V3 at 60 mA each)</li>
        </ul>

        <h3>Connectors and Pin-out</h3>
        <ul>
          <li><strong>VCC:</strong> 2-pin JST-XH, 5 V fused supply input</li>
          <li><strong>GND:</strong> 2-pin JST-XH, GND input</li>
          <li><strong>LED_ACT:</strong> SMD status LED</li>
          <li><strong>BOOT1:</strong> SMD button, hold BOOT low for ESP32 flash mode</li>
          <li><strong>RST1:</strong> MD button, manual reset to ground EN pin</li>
        </ul>

        <h2>Performance Specifications</h2>
        <ul>
          <li><strong>Microcontroller:</strong> ESP32-C3FH4 with Wi-Fi + BLE</li>
          <li><strong>Input Voltage:</strong> 5 V (external supply)</li>
          <li><strong>Fuse Rating:</strong> 3 A Littelfuse</li>
          <li><strong>LED Type:</strong> WS2812B-MINI-V3 (RGB)</li>
          <li><strong>LED Count:</strong> 44 (logo chain + status bar)</li>
          <li><strong>Max LED Current:</strong> 2.6 A worst-case</li>
          <li><strong>Level Shifting:</strong> 3.3 V to 5 V per data line</li>
          <li><strong>Board Layers:</strong> 4-layer with power planes</li>
        </ul>

        <h2>Applications</h2>
        <p>This LED controller is ideal for:</p>
        <ul>
          <li><strong>3D Printing:</strong> AT2 printer with decorative and status lighting</li>
          <li><strong>Progress Indication:</strong> Real-time print progress display</li>
          <li><strong>Temperature Alerts:</strong> Visual warnings for hot end or bed temperature</li>
          <li><strong>Custom Animations:</strong> User-defined lighting effects</li>
          <li><strong>Learning Platform:</strong> ESP32-C3 and addressable LED development</li>
        </ul>

        <h2>Mounting Guidelines</h2>
        <ol>
          <li>Slide PCB into printer's mounting slot</li>
          <li>Secure with one M3 screw</li>
          <li>Maintain antenna keep-out clearance</li>
          <li>Route power cables away from ESP32 area</li>
        </ol>

        <h2>Safety Notes</h2>
        <ul>
          <li>Use AWG-22 (or larger) wire for runs greater than 50 cm at 3 A</li>
          <li>Replace fuse only with same rating</li>
          <li>Inspect connectors periodically for heat discoloration</li>
          <li>Ensure proper polarity when connecting LED chains</li>
        </ul>

        <h2>Testing & Validation</h2>
        <ul>
          <li><strong>Power Delivery:</strong> Verified 5 V input with 3 A fuse protection</li>
          <li><strong>LED Testing:</strong> Full-white current draw measurement</li>
          <li><strong>Signal Integrity:</strong> Level shifter output verification</li>
          <li><strong>Connectivity:</strong> Wi-Fi and BLE range and reliability testing</li>
          <li><strong>Thermal Testing:</strong> LED chain operation at sustained output</li>
        </ul>

        <h2>Roadmap</h2>
        <ul>
          <li>Example animations for logo and status bar</li>
          <li>WebSocket API for real-time control</li>
          <li>OTA firmware updates</li>
        </ul>

        <p>This project demonstrates how proper PCB design with dedicated power planes can ensure reliable addressable LED operation with ESP32 microcontrollers.</p>
      </div>
    </article>
  )
}
